---
version: "1.0"
description: "SafeSkillAgent threat signature database"

signatures:
  # === REVERSE SHELLS ===
  - id: "SIG-REVSHELL-001"
    name: "Bash reverse shell"
    category: "reverse-shell"
    severity: critical
    description: "Bash TCP reverse shell"
    patterns:
      - 'bash\s+-i\s+>&?\s*/dev/tcp/\d+\.\d+\.\d+\.\d+/\d+'
      - '/bin/bash\s+-i\s+>&?\s*/dev/tcp/'
    references:
      - "https://attack.mitre.org/techniques/T1059/"

  - id: "SIG-REVSHELL-002"
    name: "Python reverse shell"
    category: "reverse-shell"
    severity: critical
    description: "Python socket-based reverse shell"
    patterns:
      - 'python[23]?\s+-c\s+.*socket.*connect.*dup2.*exec'
      - 'python[23]?\s+-c\s+.*import\s+socket.*subprocess'
      - '__import__\(["\x27]os["\x27]\)\.dup2'
    references:
      - "https://attack.mitre.org/techniques/T1059/006/"

  - id: "SIG-REVSHELL-003"
    name: "Perl reverse shell"
    category: "reverse-shell"
    severity: critical
    description: "Perl socket-based reverse shell"
    patterns:
      - 'perl\s+-e\s+.*socket\s*\(\s*SOCKET.*INET'
      - 'perl\s+-MIO\s+-e\s+.*new\s+IO::Socket::INET'
    references:
      - "https://attack.mitre.org/techniques/T1059/"

  - id: "SIG-REVSHELL-004"
    name: "PHP reverse shell"
    category: "reverse-shell"
    severity: critical
    description: "PHP socket-based reverse shell"
    patterns:
      - 'php\s+-r\s+.*fsockopen\s*\('
      - 'php\s+-r\s+.*socket_create\s*\('
    references:
      - "https://attack.mitre.org/techniques/T1059/"

  - id: "SIG-REVSHELL-005"
    name: "Ruby reverse shell"
    category: "reverse-shell"
    severity: critical
    description: "Ruby socket-based reverse shell"
    patterns:
      - 'ruby\s+-rsocket\s+-e'
      - 'ruby\s+-e\s+.*TCPSocket\.new'
    references:
      - "https://attack.mitre.org/techniques/T1059/"

  - id: "SIG-REVSHELL-006"
    name: "Socat reverse shell"
    category: "reverse-shell"
    severity: critical
    description: "Socat-based reverse shell"
    patterns:
      - 'socat\s+.*exec:.*\bsh\b'
      - 'socat\s+.*exec:.*\bbash\b'
      - 'socat\s+.*tcp-connect:.*exec:'
    references:
      - "https://attack.mitre.org/techniques/T1059/"

  - id: "SIG-REVSHELL-007"
    name: "Mkfifo pipe reverse shell"
    category: "reverse-shell"
    severity: critical
    description: "Named pipe (mkfifo) based reverse shell"
    patterns:
      - 'mkfifo\s+\S+\s*;\s*.*nc\s+'
      - 'mkfifo\s+\S+\s*&&\s*.*nc\s+'
    references:
      - "https://attack.mitre.org/techniques/T1059/"

  # === PRIVILEGE ESCALATION ===
  - id: "SIG-PRIVESC-001"
    name: "GTFOBins sudo abuse"
    category: "privilege-escalation"
    severity: high
    description: "Common GTFOBins sudo privilege escalation patterns"
    patterns:
      - 'sudo\s+.*\bawk\b.*system\('
      - 'sudo\s+.*\bfind\b.*-exec\s+/bin/sh'
      - 'sudo\s+.*\bvim\b.*-c\s+.*!sh'
      - 'sudo\s+.*\bnano\b.*-s\s+/bin/sh'
      - 'sudo\s+.*\bless\b.*!/bin/sh'
      - 'sudo\s+.*\bman\b.*!/bin/sh'
      - 'sudo\s+.*\benv\b.*/bin/sh'
      - 'sudo\s+.*\bperl\b.*-e\s+.*exec'
      - 'sudo\s+.*\bpython[23]?\b.*-c\s+.*import\s+os'

  - id: "SIG-PRIVESC-002"
    name: "SUID exploitation"
    category: "privilege-escalation"
    severity: high
    description: "Searching for or exploiting SUID binaries"
    patterns:
      - 'find\s+/\s+.*-perm\s+[/-]?[46]000'
      - 'find\s+/\s+.*-perm\s+[/-]?u=s'
    references:
      - "https://attack.mitre.org/techniques/T1548/"

  # === CREDENTIAL ACCESS ===
  - id: "SIG-CRED-001"
    name: "Credential harvesting"
    category: "credential-access"
    severity: critical
    description: "Patterns for harvesting credentials from common locations"
    patterns:
      - 'cat\s+.*/\.aws/credentials'
      - 'cat\s+.*/\.docker/config\.json'
      - 'cat\s+.*/\.kube/config'
      - 'cat\s+.*/\.npmrc'
      - 'cat\s+.*/\.pypirc'
      - 'cat\s+.*/\.env'
      - 'cat\s+.*/\.netrc'
      - 'cat\s+.*/\.pgpass'
    references:
      - "https://attack.mitre.org/techniques/T1552/"

  - id: "SIG-CRED-002"
    name: "Password spray/brute force"
    category: "credential-access"
    severity: high
    description: "Known brute force tools"
    patterns:
      - '\b(hydra|medusa|ncrack|patator|hashcat|john)\b.*(-l|-L|-u|-U|-P)'
    references:
      - "https://attack.mitre.org/techniques/T1110/"

  # === DEFENSE EVASION ===
  - id: "SIG-EVASION-001"
    name: "Log tampering"
    category: "defense-evasion"
    severity: high
    description: "Attempts to clear or tamper with system logs"
    patterns:
      - '>\s*/var/log/(syslog|auth\.log|messages|secure|kern\.log|wtmp|btmp)'
      - 'rm\s+(-[a-zA-Z]*)?\s*/var/log/'
      - 'truncate\s+.*-s\s+0\s+/var/log/'
      - 'shred\s+.*\s+/var/log/'
    references:
      - "https://attack.mitre.org/techniques/T1070/"

  - id: "SIG-EVASION-002"
    name: "Timestomping"
    category: "defense-evasion"
    severity: medium
    description: "File timestamp manipulation"
    patterns:
      - 'touch\s+-t\s+\d{12}'
      - 'touch\s+-r\s+\S+\s+\S+'
      - 'touch\s+--reference='
    references:
      - "https://attack.mitre.org/techniques/T1070/006/"

  # === LATERAL MOVEMENT ===
  - id: "SIG-LATERAL-001"
    name: "SSH tunneling"
    category: "lateral-movement"
    severity: medium
    description: "SSH port forwarding and tunneling"
    patterns:
      - 'ssh\s+.*-L\s+\d+:\S+:\d+'
      - 'ssh\s+.*-R\s+\d+:\S+:\d+'
      - 'ssh\s+.*-D\s+\d+'
      - 'ssh\s+.*-w\s+'
    references:
      - "https://attack.mitre.org/techniques/T1572/"

  # === ENCODED PAYLOADS ===
  - id: "SIG-ENCODED-001"
    name: "Base64 encoded execution"
    category: "obfuscation"
    severity: high
    description: "Decoding and executing base64 payloads"
    patterns:
      - 'echo\s+\S+\s*\|\s*base64\s+(-d|--decode)\s*\|\s*(bash|sh|python|perl)'
      - 'base64\s+(-d|--decode)\s+\S+\s*\|\s*(bash|sh|python|perl)'
      - 'printf\s+.*\|\s*base64\s+(-d|--decode)\s*\|'
    references:
      - "https://attack.mitre.org/techniques/T1027/"

  - id: "SIG-ENCODED-002"
    name: "Hex encoded payload"
    category: "obfuscation"
    severity: high
    description: "Hex-encoded command execution"
    patterns:
      - 'echo\s+-e\s+.*\\\\x[0-9a-fA-F]{2}.*\|\s*(bash|sh)'
      - 'printf\s+.*\\\\x[0-9a-fA-F]{2}.*\|\s*(bash|sh)'
      - 'xxd\s+-r\s+-p\s*\|\s*(bash|sh)'

  # === CONTAINER ESCAPE ===
  - id: "SIG-CONTAINER-001"
    name: "Container escape"
    category: "container-escape"
    severity: critical
    description: "Known container escape techniques"
    patterns:
      - 'nsenter\s+.*--mount.*--pid.*--net'
      - 'docker\s+run\s+.*--privileged'
      - 'docker\s+run\s+.*-v\s+/:/host'
      - 'mount\s+.*cgroup.*rdma'
    references:
      - "https://attack.mitre.org/techniques/T1611/"

  # === SUPPLY CHAIN ===
  - id: "SIG-SUPPLY-001"
    name: "Suspicious package install"
    category: "supply-chain"
    severity: medium
    description: "Installing packages from untrusted sources"
    patterns:
      - 'pip\s+install\s+--index-url\s+http://'
      - 'pip\s+install\s+--trusted-host\s+'
      - 'npm\s+install\s+.*--registry\s+http://'
      - 'gem\s+install\s+.*--source\s+http://'
    references:
      - "https://attack.mitre.org/techniques/T1195/"
